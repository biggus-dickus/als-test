!function(){"use strict";function e(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.querySelector("main");t.innerHTML="",t.appendChild(e)}function n(e){return'<h2 class="title title--secondary order-form__title js-title">'+p(e)+"</h2>"}function o(){return'\n        <button type="button" class="text-btn text-btn--action order-form__add js-add-row">\n            <span class="text-btn__text">Добавить оттенок</span>\n        </button>'}function r(){return'\n        <aside class="order-form__sidebar">\n            <ul class="reset-list order-form__list">\n                <li class="order-form__list-item">\n                    <a class="order-form__list-link order-form__list-link--current">Состав заказа</a>\n                </li>\n                <li class="order-form__list-item">\n                    <a href="#" class="order-form__list-link">Комментарий</a>\n                </li>\n                <li class="order-form__list-item">\n                    <a href="#" class="order-form__list-link">Контактное лицо</a>\n                </li>\n            </ul>\n\n            <button type="submit" class="btn order-form__btn">Отправить</button>\n        </aside>'}function i(){return'\n        <table class="order-table order-form__table js-table">\n            <thead>\n            <tr>\n                <th class="order-table__color-th">Цвет</th>\n                <th class="order-table__checkbox-th">\n                    <input type="checkbox" class="checkbox-input visually-hidden js-master-checkbox" id="toggle-all" checked>\n                    <label for="toggle-all" class="order-table__label" title="Отметить все">\n                        <span class="visually-hidden">Отметить все</span>\n                    </label>\n                </th>\n                <th class="order-table__tint-th">Оттенок</th>\n                <th class="order-table__amount-th">Объем</th>\n                <th class="order-table__unit-th">Упаковка</th>\n                <th class="order-table__buttons-th">\n                    <button type="button" class="remove-btn order-table__remove js-master-remove" title="Убрать все">\n                    <span class="visually-hidden">Убрать все</span>\n                    </button>\n                </th>\n            </tr>\n            </thead>\n            <tbody></tbody>\n        </table>'}function s(e,t,n){var o=Object.keys(n).map(function(e){return e+'="'+n[e]+'"'}),r=e.map(function(e){var n=e.value===t?"selected":"";return'<option value="'+e.value+'" '+n+">"+e.name+"</option>"});return"<select "+o.join(" ")+">"+r+"</select>"}var a={cyan:"циан","deep-blue":"глубокий",indigo:"индиго","light-blue":"голубой","navy-blue":"морской","royal-blue":"королевский","sky-blue":"небесный"},l={L:"л",can:"банка","package":"состав заказа",comment:"комментарий",contactPerson:"контактное лицо",blue:"синий"},u=Object.freeze({currentSection:l["package"],colors:{blue:[{tint:"sky-blue",amount:1,unit:l.L,container:l.can,isChecked:!0},{tint:"light-blue",amount:2,unit:l.L,container:l.can,isChecked:!0},{tint:"deep-blue",amount:1,unit:l.L,container:l.can,isChecked:!0},{tint:"royal-blue",amount:3,unit:l.L,container:l.can,isChecked:!0}]}}),c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},f=function(){function e(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(l){r=!0,i=l}finally{try{!o&&a["return"]&&a["return"]()}finally{if(r)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},_=function(){function e(t){c(this,e),this.state=t}return h(e,[{key:"setState",value:function(e){this.state=e}},{key:"addTint",value:function(e){var t=d({},this.state),n=t.colors.blue;n.push(e),this.setState(t)}},{key:"removeTint",value:function(e){var t=d({},this.state),n=t.colors.blue;n.splice(e,1),this.setState(t)}},{key:"removeAllTints",value:function(){var e=d({},this.state),t=e.colors.blue;t.length=0,this.setState(e)}},{key:"toggleAllTints",value:function(e){var t=d({},this.state),n=t.colors.blue;n.forEach(function(t){return t.isChecked=e}),this.setState(t)}},{key:"changeValue",value:function(e,t,n){var o=d({},this.state),r=o.colors.blue;r[e][t]=n,this.setState(o)}}]),e}(),w=new _(u),p=function(e){switch(e){case 0:return"Выбрано "+e+" оттенков";case 1:return"Выбран "+e+" оттенок";case 2:case 3:case 4:return"Выбраны "+e+" оттенка";case 5:case 6:case 7:case 8:case 9:return"Выбраны "+e+" оттенков";default:return"Выбрано оттенков: "+e}},g=function(){function e(){c(this,e)}return h(e,[{key:"render",value:function(){return e.createElement(this.template)}},{key:"bind",value:function(){}},{key:"template",get:function(){throw Error("You called the abstract method. Template string must be provided to render the view.")}},{key:"element",get:function(){return this._element||(this._element=this.render(),this.bind()),this._element}}],[{key:"createElement",value:function(e){var t=document.createElement("template");return t.innerHTML=e,t.content}}]),e}(),y=function(e){function t(e){c(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._state=e.state,n}return v(t,e),h(t,[{key:"bind",value:function(){this.body=this.element.querySelector(".js-body"),this.title=this.body.querySelector(".js-title"),this.table=this.body.querySelector(".js-table"),this.masterCheckbox=this.table.querySelector(".js-master-checkbox");var e=this.table.querySelector(".js-master-remove"),t=this.element.querySelector(".js-add-row");this.submitBtn=this.element.querySelector(".order-form__btn"),t.addEventListener("click",this.onRowAdd),this.masterCheckbox.addEventListener("change",this.onAllRowsToggle),e.addEventListener("click",this.onAllRowsRemove),this.submitBtn.addEventListener("click",this.onSubmit)}},{key:"onRowAdd",value:function(){}},{key:"onAllRowsToggle",value:function(){}},{key:"onAllRowsRemove",value:function(){}},{key:"onSubmit",value:function(){}},{key:"template",get:function(){var e=this._state.colors;return'\n        <form action="?" method="get" class="order-form">\n            <section class="order-form__body js-body">\n                '+n(e.blue.length)+"\n                "+i()+"\n                "+o()+"\n            </section>\n            "+r()+"\n        </form>"}}]),t}(g),k=function(e){function t(e){c(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._data=e,n}return v(t,e),h(t,[{key:"bind",value:function(){this.removeBtn=this.element.querySelector(".js-remove-row"),this.removeBtn.addEventListener("click",this.onRemove),this.checkbox=this.element.querySelector(".js-toggle-row"),this.checkbox.addEventListener("change",this.onRowToggle),this.select=this.element.querySelector(".js-select"),this.select.addEventListener("change",this.onSelectChange),this.input=this.element.querySelector(".js-input"),this.input.addEventListener("change",this.onInputChange)}},{key:"onRemove",value:function(){}},{key:"onRowToggle",value:function(){}},{key:"onSelectChange",value:function(){}},{key:"onInputChange",value:function(){}},{key:"template",get:function(){var e=this._data;if(!e||!Object.keys(e).length)throw Error("To render the row, color data must be provided.");var t=[];Object.entries(a).map(function(e){var n=f(e,2),o=n[0],r=n[1];return t.push({name:r.charAt(0).toUpperCase()+r.substr(1),value:o})});var n=s(t,e.tint,{"class":"select order-table__input js-select",name:"tint-"+e.rowIndex,id:"tint-"+e.rowIndex,"data-index":e.rowIndex}),o=e.isFirstRow?'<td rowspan="'+e.rowIndex+'" class="order-table__rowspan-td js-rowspan">\n                <span class="order-table__color-val">'+e.color+"</span>\n            </td>":"",r='\n            <td>\n                <input type="checkbox" class="checkbox-input visually-hidden js-toggle-row" id="toggle-'+e.tint+"-"+e.rowIndex+'" checked='+e.isChecked+' data-index="'+e.rowIndex+'">\n                <label for="toggle-'+e.tint+"-"+e.rowIndex+'" class="order-table__label" title="Отметить оттенок">\n                 <span class="visually-hidden">Отметить оттенок</span>\n              </label>\n            </td>',i="<td>"+n+"</td>",l='\n            <td class="order-table__amount-td">\n                <input type="number" name="'+e.tint+'-amount" class="text-input order-table__num-input js-input" value="'+e.amount+'" data-index="'+e.rowIndex+'" min="1" max="5">\n                <span class="order-table__amount">'+e.unit+"</span>\n            </td>",u='<td class="order-table__unit-td">'+e.container+"</td>",c='\n            <td>\n                <button type="button" class="js-remove-row remove-btn order-table__remove" data-index="'+e.rowIndex+'" title="Убрать оттенок">\n                     <span class="visually-hidden">Убрать оттенок</span>\n                </button>\n            </td>',h=[o,r,i,l,u,c].filter(function(e){return e}).join("");return"<tr>"+h+"</tr>"}}]),t}(g),R=function(){function e(t){c(this,e);var n=d({},t);delete n.onRowRemove,delete n.updateIndexes,delete n.onRowToggle,this._view=new k(n),this._onRowRemove=t.onRowRemove,this._onRowToggle=t.onRowToggle,this._updateIndexes=t.updateIndexes}return h(e,[{key:"render",value:function(e){var t=this;this._view.onRemove=function(e){t._onRowRemove(e.target.dataset.index),t._view.removeBtn.removeEventListener("click",t._view.onRemove),t._view.checkbox.removeEventListener("change",t._view.onRowToggle),t._view.select.removeEventListener("change",t._view.onSelectChange),t._view.input.removeEventListener("change",t._view.onInputChange),e.target.parentNode.parentNode.remove(),t._updateIndexes(e.target.dataset.index)},this._view.onRowToggle=function(e){return t._onRowToggle(e.target.dataset.index,e.target.checked)},this._view.onSelectChange=function(e){return w.changeValue(e.target.dataset.index,"tint",e.target.value)},this._view.onInputChange=function(e){return w.changeValue(e.target.dataset.index,"amount",+e.target.value)},e.appendChild(this._view.element)}}]),e}(),x=function(){function n(){c(this,n),this._view=new y(w),this.addRow=this.addRow.bind(this),this.removeRow=this.removeRow.bind(this),this.onAllRowsRemove=this.onAllRowsRemove.bind(this),this.onAllRowsToggle=this.onAllRowsToggle.bind(this),this.onRowToggle=this.onRowToggle.bind(this),this._updateIndexes=this._updateIndexes.bind(this)}return h(n,[{key:"render",value:function(){this._view.onAllRowsToggle=this.onAllRowsToggle,this._view.onAllRowsRemove=this.onAllRowsRemove,this._view.onRowAdd=this.addRow,this._view.onSubmit=n.onFormSubmit,t(this._view.element),this._init()}},{key:"addRow",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments[3],i=Object.keys(a),s={tint:i[Math.floor(Math.random()*i.length)],amount:e(1,5),unit:l.L,container:l.can,isChecked:!0},u=o?o:s;o||w.addTint(s),new R(d({},u,{isFirstRow:o?n:1===w.state.colors.blue.length,rowIndex:r>=0?r:w.state.colors.blue.length-1,color:l.blue,onRowRemove:this.removeRow,onRowToggle:this.onRowToggle,updateIndexes:this._updateIndexes})).render(this._view.table.tBodies[0]),this._view.submitBtn.disabled&&this._view.submitBtn.removeAttribute("disabled"),this._updateRowspan(w.state.colors.blue.length),this._updateTitle()}},{key:"removeRow",value:function(e){this._rowSpanCell=this._view.table.querySelector(".js-rowspan"),w.removeTint(e),this._updateRowspan(w.state.colors.blue.length),this._updateTitle(),w.state.colors.blue.length||(this._view.submitBtn.disabled=!0)}},{key:"onRowToggle",value:function(e,t){w.changeValue(e,"isChecked",t),this._updateTitle(),this._view.submitBtn.disabled=!w.state.colors.blue.some(function(e){return e.isChecked})}},{key:"onAllRowsToggle",value:function(){var e=this._view.table.querySelectorAll(".js-toggle-row");if(e.length){w.toggleAllTints(this._view.masterCheckbox.checked);var t=!0,n=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;s.checked=this._view.masterCheckbox.checked}}catch(a){n=!0,o=a}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw o}}this._updateTitle(),this._view.submitBtn.disabled=!w.state.colors.blue.some(function(e){return e.isChecked})}}},{key:"onAllRowsRemove",value:function(){this._view.table.tBodies[0].children.length&&(w.removeAllTints(),this._view.table.tBodies[0].innerHTML="",this._view.submitBtn.disabled=!0,this._updateTitle())}},{key:"_onFirstRowRemove",value:function(e,t){0===+e&&t&&(t.insertBefore(this._rowSpanCell,t.children[0]),this._updateRowspan(w.state.colors.blue.length)),this._rowSpanCell=null}},{key:"_updateTitle",value:function(){var e=w.state.colors.blue.filter(function(e){return e.isChecked});this._view.title.textContent=p(e.length)}},{key:"_updateIndexes",value:function(e){var t=[].concat(m(this._view.table.tBodies[0].querySelectorAll("tr")));t.forEach(function(e,t){var n=[].concat(m(e.querySelectorAll("[data-index]")));n.forEach(function(e){return e.dataset.index=t})}),this._onFirstRowRemove(e,t[0])}},{key:"_updateRowspan",value:function(e){var t=this._view.table.querySelector(".js-rowspan");t&&t.setAttribute("rowspan",e)}},{key:"_init",value:function(){var e=this;w.state.colors.blue.forEach(function(t,n){return e.addRow(null,0===n,t,n)})}}],[{key:"onFormSubmit",value:function(e){e.preventDefault();var t=[];w.state.colors.blue.filter(function(e){return e.isChecked}).forEach(function(e,n){var o=++n;t.push("tint"+o+"="+e.tint+"&amount"+o+"="+e.amount)}),alert("Форма отправит следующие данные:\ncolor=blue&\n"+t.join("\n"))}}]),n}();(new x).render()}();